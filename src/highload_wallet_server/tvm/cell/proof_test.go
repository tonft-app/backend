package cell

import (
	"encoding/hex"
	"testing"
)

func TestProofCheck(t *testing.T) {
	accountProof, _ := hex.DecodeString("b5ee9c7201021f010003a8000946036ab76d71145811e08f772ec93c4159c29ca7512d3e4688b75b08382d47abd5f5016f01245b9023afe2ffffff1100ffffffff0000000000000000019edf8b0000000163e3852500001ff3a6dcc444019edf886002030405284801014b37adeb84aafb46d91bae8be1281bd67f880c77aae62b6c1197f3fa67794dd7000128480101200fd8b67011b149538cae7ab1be3a8d6530f193dceb373b10ed11f9a07ead70016e22330000000000000000ffffffffffffffff81fe7ee770c0c126e82806072455cc26aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaac233e10144057f6b7e08090a0b28480101a5a7d24057d8643b2527709d986cda3846adcb3eddc32d28ec21f69e17dbaaef0001284801012c00905b7ddb998b2200aecebfb52be3f1ef91aaffb836fd23a62f8511102a5e000e2848010113ac849254b1bc695b02d59ade963543d059836ee907fd8fb1c400595532de9600022201200c0d22bf00019ced53bb00062886600003fe74d9b040880000ff8884c2e4200cf5af64662e33597f9a0d8ae069c0fdf8908a94a5f256610b1bd893a67b7c03d76cf464e75a15cd7de96547731f5c49b5cf86cdf3475efc741b656f293ce3755840fbf0be1d1e28480101b20e36a3b36a4cdee601106c642e90718b0a58daf200753dbb3189f956b494b600012202d80e0f2848010124d21cf7ae96b1c55a1230e823db0317ce24ec33e3bf2585c79605684304faf20007220120101128480101fd78695ffd58402e209cb0b060c95b1a8a83dae389c7eac9554a3c086e52b898000722012012132848010120681854d1d5bdeca272e3c85af6f487f0b6845017253f2a14590939d625ccf2000c220120141528480101fb995c727bab36d7e0b97b3b4330bd41f125d5cf1ab5d7ee9d32ed5910566153000828480101a803208fc3523afed9a219f83157922090cbf14019d0bee0e2523cd35f122896000522012016172201201819284801018d65a4182ee8c6bb9016165e49f913807af3190dcfa61eb27c258d7c7d3dcb9900032201201a1b28480101dc56084563cc28588672914d638ea338abbe52d62660a9db136484469427634900090101201c28480101c1f3c2ada12bd901bba1552c0c090cc3989649807c2b764d02548c1f664c20890007001ac400000002000000000000002e28480101d3613ca05307e6ac0ef5427c98496c512bba2acc609ce7dfa90786801d80b5fe0019284801015ceb19b906fa6ba5df69eaaf5a206d31b200f9fd861c2db436deb910e2f44cbb0011")
	cl, err := FromBOC(accountProof)
	if err != nil {
		t.Fatal(err)
	}

	hash, _ := hex.DecodeString("6AB76D71145811E08F772EC93C4159C29CA7512D3E4688B75B08382D47ABD5F5")
	err = CheckProof(cl, hash)
	if err != nil {
		t.Fatal(err)
	}
}

func TestProofOfProofCreate(t *testing.T) {
	accountProof, _ := hex.DecodeString("b5ee9c7201021f010003a8000946036ab76d71145811e08f772ec93c4159c29ca7512d3e4688b75b08382d47abd5f5016f01245b9023afe2ffffff1100ffffffff0000000000000000019edf8b0000000163e3852500001ff3a6dcc444019edf886002030405284801014b37adeb84aafb46d91bae8be1281bd67f880c77aae62b6c1197f3fa67794dd7000128480101200fd8b67011b149538cae7ab1be3a8d6530f193dceb373b10ed11f9a07ead70016e22330000000000000000ffffffffffffffff81fe7ee770c0c126e82806072455cc26aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaac233e10144057f6b7e08090a0b28480101a5a7d24057d8643b2527709d986cda3846adcb3eddc32d28ec21f69e17dbaaef0001284801012c00905b7ddb998b2200aecebfb52be3f1ef91aaffb836fd23a62f8511102a5e000e2848010113ac849254b1bc695b02d59ade963543d059836ee907fd8fb1c400595532de9600022201200c0d22bf00019ced53bb00062886600003fe74d9b040880000ff8884c2e4200cf5af64662e33597f9a0d8ae069c0fdf8908a94a5f256610b1bd893a67b7c03d76cf464e75a15cd7de96547731f5c49b5cf86cdf3475efc741b656f293ce3755840fbf0be1d1e28480101b20e36a3b36a4cdee601106c642e90718b0a58daf200753dbb3189f956b494b600012202d80e0f2848010124d21cf7ae96b1c55a1230e823db0317ce24ec33e3bf2585c79605684304faf20007220120101128480101fd78695ffd58402e209cb0b060c95b1a8a83dae389c7eac9554a3c086e52b898000722012012132848010120681854d1d5bdeca272e3c85af6f487f0b6845017253f2a14590939d625ccf2000c220120141528480101fb995c727bab36d7e0b97b3b4330bd41f125d5cf1ab5d7ee9d32ed5910566153000828480101a803208fc3523afed9a219f83157922090cbf14019d0bee0e2523cd35f122896000522012016172201201819284801018d65a4182ee8c6bb9016165e49f913807af3190dcfa61eb27c258d7c7d3dcb9900032201201a1b28480101dc56084563cc28588672914d638ea338abbe52d62660a9db136484469427634900090101201c28480101c1f3c2ada12bd901bba1552c0c090cc3989649807c2b764d02548c1f664c20890007001ac400000002000000000000002e28480101d3613ca05307e6ac0ef5427c98496c512bba2acc609ce7dfa90786801d80b5fe0019284801015ceb19b906fa6ba5df69eaaf5a206d31b200f9fd861c2db436deb910e2f44cbb0011")
	cl, err := FromBOC(accountProof)
	if err != nil {
		t.Fatal(err)
	}

	hash, _ := hex.DecodeString("6AB76D71145811E08F772EC93C4159C29CA7512D3E4688B75B08382D47ABD5F5")
	err = CheckProof(cl, hash)
	if err != nil {
		t.Fatal(err)
	}

	kk := cl.BeginParse().MustLoadRef()
	kk.MustLoadRef()
	kk.MustLoadRef()
	fn := kk.MustLoadRef().MustToCell()

	prf, err := cl.CreateProof([][]byte{fn.Hash()})
	if err != nil {
		t.Fatal(err)
	}
	println(prf.Dump())

	hash2, _ := hex.DecodeString("D3B8077755C605D944CC4C57E1D38B723885EAA1699319A3DCADF018B31B558F")
	err = CheckProof(prf, hash2)
	if err != nil {
		t.Fatal(err)
	}
}
